#!/system/bin/sh
gov(){
	echo "Cores 1/2 Governor selection:"
	echo
	governors=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d')
	# Load text file lines into a bash array & print as a menu.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $governors; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/gov=/d' /$extsd/plaintweak
	sed -i '/gov=/d' /vendor/overlay/local.prop
	if [ "$input" != "0" ];then
	gov=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d' | head -n $input | tail -n 1)
	echo 'gov='$gov >> /$extsd/plaintweak
	echo 'gov='$gov >> /vendor/build.prop
	fi
clear
}
gov2(){
	echo "Cores 3/4 Governor selection:"
	echo
	governors=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d')
	# Load text file lines into a bash array & print as a menu.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $governors; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/gov2=/d' /$extsd/plaintweak
	sed -i '/gov2=/d' /vendor/build.prop
	if [ "$input" != "0" ];then
	gov=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d' | head -n $input | tail -n 1)
	echo 'gov2='$gov >> /$extsd/plaintweak
	echo 'gov2='$gov >> /vendor/build.prop
	fi
clear
}
minkhz(){
	echo "Cores 1/2 Min CPU Clock selection:"
	echo 
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/minkhz=/d' /vendor/build.prop
	sed -i '/minkhz=/d' /$extsd/plaintweak
	if [ "$input" != "0" ];then
	minkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4 | head -n $input | tail -n 1)
	echo 'minkhz='$minkhz >> /$extsd/plaintweak
	echo 'minkhz='$minkhz >> /vendor/build.prop
	fi
clear
}
minkhz2(){
	echo "Cores 3/4 Min CPU Clock selection:"
	echo 
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/minkhz2=/d' /vendor/build.prop
	sed -i '/minkhz2=/d' /$extsd/plaintweak
	if [ "$input" != "0" ];then
	minkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4 | head -n $input | tail -n 1)
	echo 'minkhz2='$minkhz >> /$extsd/plaintweak
	echo 'minkhz2='$minkhz >> /vendor/build.prop
	fi
clear
}
maxkhz(){
	echo "Cores 1/2 Max CPU Clock selection:"
	echo 
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/maxkhz=/d' /vendor/build.prop
	sed -i '/maxkhz=/d' /$extsd/plaintweak
	if [ "$input" != "0" ];then
	maxkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5 | head -n $input | tail -n 1)
	echo 'maxkhz='$maxkhz >> /$extsd/plaintweak
	echo 'maxkhz='$maxkhz >> /vendor/build.prop
	fi
clear
}
maxkhz2(){
	echo "Cores 3/4 Max CPU Clock selection:"
	echo 
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/maxkhz2=/d' /vendor/build.prop
	sed -i '/maxkhz2=/d' /$extsd/plaintweak
	if [ "$input" != "0" ];then
	maxkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5 | head -n $input | tail -n 1)
	echo 'maxkhz2='$maxkhz >> /$extsd/plaintweak
	echo 'maxkhz2='$maxkhz >> /vendor/build.prop
	fi
clear
}
scheduler(){
echo "IO Scheduler selection:"
echo 
schedulers=$(cat /sys/block/mmcblk0/queue/scheduler | sed 's/[[]//g' | sed 's/[]]//g' | sed 's/ /\n/g' | sed '$d')
# Load text file lines into a bash array.
OLD_IFS=$IFS
IFS=$'\n'
let line_counter=0
for line in $schedulers; do
	let line_counter=$(($line_counter+1))
	printf "${line_counter}) ${line}\n"
done
IFS=$OLD_IFS
echo "Choose number selection[0 = default or 99 = exit]:"
read input
if [ "$input" == "99" ];then
exit
fi
if [ "$input" -gt "$line_counter" ];then
echo "Invalid selection: Aborting script"
exit
fi
if [ "$input" != "0" ];then
scheduler=$(cat /sys/block/mmcblk0/queue/scheduler | sed 's/[[]//g' | sed 's/[]]//g' | sed 's/ /\n/g' | sed '$d' | sed 's/ //g' | head -n $input | tail -n 1)
echo 'scheduler='$scheduler >> /$extsd/plaintweak
sed -i '/scheduler=/d' /vendor/build.prop
echo 'scheduler='$scheduler >> /vendor/build.prop
fi
clear
}
tcpcong(){
echo "TCP Congestion Control selection:"
echo 
tcpcong=$(cat /proc/sys/net/ipv4/tcp_available_congestion_control | sed 's/ /\n/g')
# Load text file lines into a bash array.
OLD_IFS=$IFS
IFS=$'\n'
let line_counter=0
for line in $tcpcong; do
	let line_counter=$(($line_counter+1))
	printf "${line_counter}) ${line}\n"
done
IFS=$OLD_IFS
echo "Choose number selection[0 = default or 99 = exit]:"
read input
if [ "$input" == "99" ];then
exit
fi
if [ "$input" -gt "$line_counter" ];then
echo "Invalid selection: Aborting script"
exit
fi
sed -i '/tcpcong=/d' /vendor/build.prop
sed -i '/tcpcong=/d' /$extsd/plaintweak
if [ "$input" != "0" ];then
tcpcong=$(cat /proc/sys/net/ipv4/tcp_available_congestion_control | sed 's/ /\n/g' | head -n $input | tail -n 1)
echo 'tcpcong='$tcpcong >> /$extsd/plaintweak
echo 'tcpcong='$tcpcong >> /vendor/build.prop
fi
}
kernelconfig() {
	if [ -e /sdcard/plaintweak ]; then
	DATE=$(date +"%m"-"%d"-"%y")
	mkdir -p /sdcard/plain-tweak/$DATE
	mv /sdcard/plaintweak /sdcard/plain-tweak/$DATE/plaintweak
	fi
	case "$configselection" in
		maxkhz)
			maxkhz
			;;
		maxkhz2)
			maxkhz2
			;;
		minkhz)
			minkhz
			;;
		minkhz2)
			minkhz2
			;;
		gov)
			gov
			;;
		gov2)
			gov2
			;;
		scheduler)
			scheduler
			;;
		tcpcong)
			tcpcong
			;;
		*)
			"Exiting: Invalid input"
			exit
			;;
	esac
}
backupbuildprop() {
	cp /system/build.prop /system/.build.prop-original
}
restorebuildprop() {
	cp /system/.build.prop-original /system/build.prop
}
restoreplaintweakconfig() {
	mkdir -p /system/vendor/overlay
	if [ -e /sdcard/plaintweak ]; then
	cat /sdcard/plaintweak > /system/vendor/build.prop
	fi
	if [ -e /sdcard/customdensity ]; then
	cat /sdcard/customdensity >> /system/vendor/build.prop
	fi
	echo 'enable_plaintweak=1' >> /system/vendor/build.prop
	chmod 0644 /system/vendor/build.prop
}
bootanim() {
	bootanim=$(grep "debug.sf.nobootanimation" /vendor/build.prop | sed 's/debug.sf.nobootanimation*.//')
	if [ -n $bootanim ]; then
	if [ "$bootanim" == "1" ]; then
	echo "Boot Animation is currently off"
	echo "Re-enabling Boot Animation"
	sed -i -e 's/debug\.sf\.nobootanimation=1//' /vendor/build.prop
	fi
	fi
	if [ -z $bootanim ]; then
	echo "Disabling Boot Animation"
	echo "debug.sf.nobootanimation=1" >> /vendor/build.prop
	fi
}
density() {
	case "$setdensity" in
		stock)
		rm /sdcard/customdensity
		if [ -e /tmp/recovery.log ]; then
		echo $setdensity" is density obtained from Aroma" >> /tmp/recovery.log
		else
		echo -n '\03 Build-Prop Tweaks\0 Set '$customdensity' as new custom density\0' > /dev/log/main
		fi
		if [ ! -e /tmp/recovery.log ]; then
		sysro
		fi
		;;
		*)
		echo 'customdensity='$setdensity > /sdcard/customdensity
		if [ -e /tmp/recovery.log ]; then
		echo $setdensity" is density obtained from Aroma" >> /tmp/recovery.log
		else
		echo -n '\03 Build-Prop Tweaks\0 Set '$customdensity' as new custom density\0' > /dev/log/main
		fi
		if [ ! -e /tmp/recovery.log ]; then
		sysro
		fi
		;;
	esac
}
toggle() {
	toggle=$(getprop enable_plaintweak)
	sed -i '/enable_plaintweak/d' /vendor/build.prop
	if [ "$toggle" == "0" ]; then
	echo "Enabling Plain-Tweak"
	setprop enable_plaintweak 1
	fi
	if [ "$toggle" == "1" ]; then
	echo "Disabling Plain-Tweak"
	setprop enable_plaintweak 0
	fi
	}
if [ ! -e /tmp/recovery.log ]; then
sysrw
fi
extsd='sdcard'
case "$1" in
  density)
    setdensity=$2
    density
  ;;
  bootanim)
    bootanim
  ;;
  backupbuildprop)
    backupbuildprop
  ;;
  restorebuildprop)
    restorebuildprop
  ;;
  kernelconfig)
	configselection=$2
	if [ -z "$configselection" ]; then
    maxkhz 
	maxkhz2
	minkhz
	minkhz2
	gov
	gov2
	scheduler
	tcpcong
	else
	kernelconfig
	fi
  ;;
  restoreplaintweakconfig)
	restoreplaintweakconfig
  ;;
  toggle)
	toggle
  ;;
esac
